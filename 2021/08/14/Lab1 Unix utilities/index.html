<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>6.S081 Lab1 Unix Utilities | Yitao's Blog</title><meta name="keywords" content="xv6"><meta name="author" content="Wang Yitao"><meta name="copyright" content="Wang Yitao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Xv6 and Unix utilities  In this lab, we gonna implement many interesting and useful programs like, sleep, pingpong, primes, find, and xargs . There are some points I want to emphasize, though this lab">
<meta property="og:type" content="article">
<meta property="og:title" content="6.S081 Lab1 Unix Utilities">
<meta property="og:url" content="https://zjuytw.github.io/2021/08/14/Lab1%20Unix%20utilities/index.html">
<meta property="og:site_name" content="Yitao&#39;s Blog">
<meta property="og:description" content="Xv6 and Unix utilities  In this lab, we gonna implement many interesting and useful programs like, sleep, pingpong, primes, find, and xargs . There are some points I want to emphasize, though this lab">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zjuytw.github.io/img/ichigo1.jpg">
<meta property="article:published_time" content="2021-08-14T06:51:27.770Z">
<meta property="article:modified_time" content="2021-08-14T06:51:21.854Z">
<meta property="article:author" content="Wang Yitao">
<meta property="article:tag" content="xv6">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zjuytw.github.io/img/ichigo1.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zjuytw.github.io/2021/08/14/Lab1%20Unix%20utilities/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '6.S081 Lab1 Unix Utilities',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-08-14 14:51:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Yitao's Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/ichigo1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">76</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">48</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Yitao's Blog</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">6.S081 Lab1 Unix Utilities</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-08-14T06:51:27.770Z" title="Created 2021-08-14 14:51:27">2021-08-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-08-14T06:51:21.854Z" title="Updated 2021-08-14 14:51:21">2021-08-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/6-S081/">6.S081</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="6.S081 Lab1 Unix Utilities"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>Xv6 and Unix utilities</h1>

<p>In this lab, we gonna implement many interesting and useful programs like, <code>sleep, pingpong, primes, find, and xargs </code>. There are some points I want to emphasize, though this lab is not so hard.</p>
<h2>Before Start</h2>

<p>My experiment environment:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">VM: VMware workstation</span><br><span class="line">Linux ubuntu 20.04</span><br></pre></td></tr></table></figure>

<p> I can not find corresponding software in <code>apt-get</code> when my kernel was at 16.04 or 18.04, so I have to update to 20.04.</p>
<h2>Lab</h2>

<p>The structure we should know before programming is that, there are kernel’s and user’s code, when I need to do something on <code>system level</code>, we should call kernel’s function. Gracefully, we have many wrapped interface on users’ functions that we can directly call them. Check them in <code>user/user.h</code></p>
<h3>sleep</h3>

<p>Skip</p>
<h3>
    pingpong
</h3>

<p>Note that in pipe[2], pipe[0] is for receiving data and pipe[1] is for writing into.</p>
<h3>primes</h3>

<p>The brief of this algorithm is used in the situation that, assume you have a bunch of machines, to find primes given a list of numbers which continuously +1 one after another. And each stage selects one minimum number and it is exactly prime, then verify other numbers do not have the prime as their factor. Then send left numbers into next stage…</p>
<p><img src="/2021/08/14/Lab1%20Unix%20utilities/lab1-1.png" alt="lab1-1"></p>
<p>Just use recursion to find next stage’s number and send to the child’s process</p>
<h3>find</h3>

<p>Refer to <code>user/ls.c</code>, that is a good template.</p>
<p>What I want to mention is some points of File System</p>
<p><strong>struct state</strong> is the information a file descriptor refers to, stored in inode and can be fetched by fstat(fd, &amp;st)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#define T_DIR 1 // Directory</span><br><span class="line">#define T_FILE 2 // File</span><br><span class="line">#define T_DEVICE 3 // Device</span><br><span class="line">struct stat &#123;</span><br><span class="line">	int dev; // File system’s disk device</span><br><span class="line">	uint ino; // Inode number</span><br><span class="line">	short type; // Type of file</span><br><span class="line">	short nlink; // Number of links to file</span><br><span class="line">	uint64 size; // Size of file in bytes</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>struct dirent</strong> serves the same a file descriptor’s information, but it mainly provides file’s name</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct dirent</span><br><span class="line">&#123;</span><br><span class="line">    long d_ino; /* inode number */</span><br><span class="line">    off_t d_off; /* offset to this dirent */</span><br><span class="line">    unsigned short d_reclen; /* length of this d_name */</span><br><span class="line">    unsigned char d_type; /* the type of d_name */</span><br><span class="line">    char d_name [NAME_MAX+1]; /* file name (null-terminated) */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2>xargs</h2>

<p>This program helps me to understand xargs a lot, thanks gosh.</p>
<p>To implement <code>xargs</code>, we need first process <code>stdin</code> because <code>pipe</code> will redirect xargs’s stdin to last program’s stdout. When this done, we can user<code>exec()</code> to execute the command after xargs. Note that when processing stdin, we should read or gets byte by byte and when once encounter ‘\n’, do command.</p>
<h2>Conclusion</h2>

<p>This programs helps me to review the usage of them and help me dabble into <code>fork(), exec(), pipe(), and file systems</code></p>
<p><strong>Note:</strong> when programming for a child process, just use <code>exit</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Wang Yitao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://zjuytw.github.io/2021/08/14/Lab1%20Unix%20utilities/">https://zjuytw.github.io/2021/08/14/Lab1%20Unix%20utilities/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/xv6/">xv6</a></div><div class="post_share"><div class="social-share" data-image="/img/ichigo1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/08/14/Lab2%20Syscalls/"><img class="prev-cover" src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">6.S081 System Calls</div></div></a></div><div class="next-post pull-right"><a href="/2021/08/13/233.%20Number%20of%20Digit%20One/"><img class="next-cover" src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">233. Number of Digit One</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/08/14/Lab2 Syscalls/" title="6.S081 System Calls"><img class="cover" src="/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-14</div><div class="title">6.S081 System Calls</div></div></a></div><div><a href="/2021/08/14/Lab3 Page Table/" title="6.S081 Page Table"><img class="cover" src="/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-14</div><div class="title">6.S081 Page Table</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/ichigo1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Wang Yitao</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">76</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">48</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ZjuYTW"><i class="fab fa-github"></i><span>My Github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">My personal website, writing for fun and sharding knowledge</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Xv6 and Unix utilities</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.1.</span> <span class="toc-text">Before Start</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.2.</span> <span class="toc-text">Lab</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.2.1.</span> <span class="toc-text">sleep</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.2.2.</span> <span class="toc-text">
    pingpong
</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.2.3.</span> <span class="toc-text">primes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.2.4.</span> <span class="toc-text">find</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.3.</span> <span class="toc-text">xargs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.4.</span> <span class="toc-text">Conclusion</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/09/16/1998.%20GCD%20Sort%20of%20an%20Array/" title="1998. GCD Sort of an Array"><img src="/img/GbjolrOH.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1998. GCD Sort of an Array"/></a><div class="content"><a class="title" href="/2021/09/16/1998.%20GCD%20Sort%20of%20an%20Array/" title="1998. GCD Sort of an Array">1998. GCD Sort of an Array</a><time datetime="2021-09-15T16:17:28.049Z" title="Created 2021-09-16 00:17:28">2021-09-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/16/2002.%20Maximum%20Product%20of%20the%20Length%20of%20Two%20Palindromic%20Subsequences/" title="2002. Maximum Product of the Length of Two Palindromic Subsequences"><img src="/img/GbjolrOH.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2002. Maximum Product of the Length of Two Palindromic Subsequences"/></a><div class="content"><a class="title" href="/2021/09/16/2002.%20Maximum%20Product%20of%20the%20Length%20of%20Two%20Palindromic%20Subsequences/" title="2002. Maximum Product of the Length of Two Palindromic Subsequences">2002. Maximum Product of the Length of Two Palindromic Subsequences</a><time datetime="2021-09-15T16:17:28.046Z" title="Created 2021-09-16 00:17:28">2021-09-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/11/1894.%20Find%20the%20Student%20that%20Will%20Replace%20the%20Chalk/" title="1894. Find the Student that Will Replace the Chalk"><img src="/img/GbjolrOH.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1894. Find the Student that Will Replace the Chalk"/></a><div class="content"><a class="title" href="/2021/09/11/1894.%20Find%20the%20Student%20that%20Will%20Replace%20the%20Chalk/" title="1894. Find the Student that Will Replace the Chalk">1894. Find the Student that Will Replace the Chalk</a><time datetime="2021-09-10T17:11:51.276Z" title="Created 2021-09-11 01:11:51">2021-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/11/808.%20Soup%20Servings/" title="808. Soup Servings"><img src="/img/GbjolrOH.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="808. Soup Servings"/></a><div class="content"><a class="title" href="/2021/09/11/808.%20Soup%20Servings/" title="808. Soup Servings">808. Soup Servings</a><time datetime="2021-09-10T17:11:51.257Z" title="Created 2021-09-11 01:11:51">2021-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/08/798.%20Smallest%20Rotation%20with%20Highest%20Score/" title="798. Smallest Rotation with Highest Score"><img src="/img/GbjolrOH.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="798. Smallest Rotation with Highest Score"/></a><div class="content"><a class="title" href="/2021/09/08/798.%20Smallest%20Rotation%20with%20Highest%20Score/" title="798. Smallest Rotation with Highest Score">798. Smallest Rotation with Highest Score</a><time datetime="2021-09-08T12:34:08.824Z" title="Created 2021-09-08 20:34:08">2021-09-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Wang Yitao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>